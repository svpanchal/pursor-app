<!-- Watchlist Table -->
<!-- Linting disabled for this file due to JavaScript in HTML template -->
<div class="overflow-x-auto">
    <table class="min-w-full divide-y divide-gray-200">
        <thead class="bg-gray-50">
            <tr>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Item</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Site</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Current</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Δ since added</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Target</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Sparkline</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
            </tr>
        </thead>
        <tbody class="bg-white divide-y divide-gray-200">
            {% for row in rows %}
            <tr>
                <!-- Item Column -->
                <td class="px-6 py-4 whitespace-nowrap">
                    <div class="flex items-center">
                        {% if row.image_url %}
                        <img class="h-10 w-10 rounded-lg object-cover mr-3" src="{{ row.image_url }}" alt="{{ row.title }}">
                        {% endif %}
                        <div>
                            <div class="text-sm font-medium text-gray-900">
                                <a href="{{ row.url }}" target="_blank" class="hover:text-blue-600">
                                    {{ row.title }}
                                </a>
                            </div>
                            <div class="text-sm text-gray-500">
                                {{ row.domain }}
                            </div>
                        </div>
                    </div>
                </td>
                
                <!-- Site Column -->
                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                    {{ row.site_name or "—" }}
                </td>
                
                <!-- Current Price Column -->
                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                    {% if row.current_cents %}
                        ${{ "%.2f"|format(row.current_cents / 100) }}
                    {% else %}
                        <span class="text-gray-400">—</span>
                    {% endif %}
                </td>
                
                <!-- Delta Column -->
                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                    {{ row.delta_pct }}
                </td>
                
                <!-- Target Column -->
                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                    {% if row.target_cents %}
                        {% set target_met = row.current_cents and row.current_cents <= row.target_cents %}
                        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium {{ 'bg-green-100 text-green-800' if target_met else 'bg-gray-100 text-gray-800' }}">
                            ${{ "%.2f"|format(row.target_cents / 100) }}
                        </span>
                    {% else %}
                        <span class="text-gray-400">—</span>
                    {% endif %}
                </td>
                
                <!-- Sparkline Column -->
                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                    {% if row.sparkline.data %}
                        <canvas id="spark-{{ row.id }}" width="100" height="30"></canvas>
                        <script>
                            (function() {
                                const ctx = document.getElementById('spark-{{ row.id }}').getContext('2d');
                                new Chart(ctx, {
                                    type: 'line',
                                    data: {
                                        labels: {{ row.sparkline.labels | tojson }},
                                        datasets: [{
                                            data: {{ row.sparkline.data | tojson }},
                                            borderColor: '#3B82F6',
                                            backgroundColor: 'rgba(59, 130, 246, 0.1)',
                                            tension: 0.3,
                                            pointRadius: 0,
                                            borderWidth: 1
                                        }]
                                    },
                                    options: {
                                        responsive: false,
                                        maintainAspectRatio: false,
                                        plugins: {
                                            legend: { display: false }
                                        },
                                        scales: {
                                            x: { display: false },
                                            y: { display: false }
                                        },
                                        elements: {
                                            point: { radius: 0 }
                                        }
                                    }
                                });
                            })();
                        </script>
                    {% else %}
                        <span class="text-gray-400">—</span>
                    {% endif %}
                </td>
                
                <!-- Actions Column -->
                <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                    <form hx-delete="/items/{{ row.id }}" hx-target="#list" hx-swap="outerHTML">
                        <button type="submit" class="text-red-600 hover:text-red-900 underline">
                            Remove
                        </button>
                    </form>
                </td>
            </tr>
            {% else %}
            <tr>
                <td colspan="7" class="px-6 py-12 text-center text-gray-500">
                    <div class="text-lg font-medium mb-2">No items in your watchlist yet</div>
                    <div class="text-sm">Add a product URL above to start tracking prices</div>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
